<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>My To-Do — SNPSU HRD</title>
<style>
:root{--bg:#f6fbff;--card:#fff;--accent:#0b63d6;--muted:#6b7280;--glass:rgba(11,99,214,0.06)}
*{box-sizing:border-box;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
body{margin:0;background:var(--bg);padding:20px;display:flex;justify-content:center;min-height:100vh}
.wrap{width:100%;max-width:900px}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
.h1{font-weight:800;color:var(--accent);font-size:20px}
.sub{color:var(--muted);font-size:13px}
.btn{padding:10px 12px;border-radius:10px;border:0;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
.ghost{background:#fff;border:1px solid #e6eefb;color:var(--accent)}
.card{background:var(--card);border-radius:12px;box-shadow:0 8px 30px var(--glass);padding:18px;margin-bottom:14px}
.row{display:flex;gap:10px}
.input,select{padding:10px;border-radius:8px;border:1px solid #e6eefb;font-size:14px;background:#fff}
.list{margin-top:12px}
.item{padding:12px;border-radius:10px;border:1px solid #eef6ff;background:#fff;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center}
.title{font-weight:700}
.badge{padding:4px 8px;border-radius:8px;font-size:12px;font-weight:700}
.hi{background:rgba(239,68,68,0.12);color:#ef4444}
.md{background:rgba(234,179,8,0.12);color:#eab308}
.lo{background:rgba(16,185,129,0.12);color:#10b981}
.checkbox{width:20px;height:20px;border-radius:6px;border:1px solid #cbd5e1;display:flex;align-items:center;justify-content:center;cursor:pointer}
.done{background:rgba(16,185,129,0.25);border-color:#10b981;color:#10b981}
.empty{color:var(--muted);padding:20px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  
  <div class="header">
    <div>
      <div class="h1">My To-Do</div>
      <div class="sub">Private tasks visible only to you</div>
    </div>
    <div style="display:flex;gap:8px">
      <button class="btn ghost" id="backBtn">Back</button>
      <button class="btn" id="logoutBtn">Logout</button>
    </div>
  </div>

  <div class="card">
    <div style="font-weight:700;margin-bottom:10px">Add new task</div>
    
    <div class="row">
      <input id="title" class="input" placeholder="Task title" style="flex:2">
      <select id="priority" class="input" style="flex:1">
        <option value="High">High</option>
        <option value="Medium" selected>Medium</option>
        <option value="Low">Low</option>
      </select>
    </div>

    <button id="addBtn" class="btn" style="margin-top:10px;width:100%">Add Task</button>
    <div id="error" class="sub" style="color:#ef4444;margin-top:6px"></div>
  </div>

  <div class="card">
    <div style="font-weight:700;margin-bottom:10px">Your tasks</div>
    <div id="list" class="list"></div>
  </div>

</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  function getLogged(){
    try{return JSON.parse(localStorage.getItem('loggedInTeacher')||'null')}catch(e){return null}
  }

  const user = getLogged()
  if(!user){ location.href = './login.html'; return }

  const empId = user.empId

  function loadTodos(){
    try{return JSON.parse(localStorage.getItem('todos_' + empId) || '[]')}catch(e){return []}
  }
  function saveTodos(list){
    localStorage.setItem('todos_' + empId, JSON.stringify(list))
  }

  const titleEl = document.getElementById('title')
  const prioEl = document.getElementById('priority')
  const listEl = document.getElementById('list')
  const errorEl = document.getElementById('error')

  document.getElementById('backBtn').addEventListener('click', ()=> location.href='./dashboard.html')
  document.getElementById('logoutBtn').addEventListener('click', ()=>{ localStorage.removeItem('loggedInTeacher'); location.href='./login.html' })

  document.getElementById('addBtn').addEventListener('click', ()=>{
    const title = (titleEl.value||'').trim()
    const prio = prioEl.value

    if(!title){
      errorEl.textContent = 'Title required'
      return
    }
    errorEl.textContent = ''

    const todos = loadTodos()
    todos.unshift({
      id: 't'+Date.now(),
      title,
      priority: prio,
      done: false,
      createdAt: new Date().toISOString()
    })
    saveTodos(todos)
    titleEl.value = ''
    render()
  })

  function render(){
    const todos = loadTodos()
    listEl.innerHTML = ''
    if(todos.length === 0){
      listEl.innerHTML = '<div class="empty">No tasks added</div>'
      return
    }

    todos.forEach(task=>{
      const div = document.createElement('div')
      div.className = 'item'

      const left = document.createElement('div')
      const title = document.createElement('div')
      title.className = 'title'
      title.textContent = task.title
      const badge = document.createElement('span')
      badge.className = 'badge ' + (task.priority==='High'?'hi':task.priority==='Medium'?'md':'lo')
      badge.textContent = task.priority

      left.appendChild(title)
      left.appendChild(badge)

      const right = document.createElement('div')
      right.className = 'checkbox'
      right.textContent = task.done ? '✓' : ''
      if(task.done) right.classList.add('done')

      right.addEventListener('click', ()=>{
        const todos = loadTodos()
        const t = todos.find(t=>t.id===task.id)
        t.done = !t.done
        saveTodos(todos)
        render()
      })

      div.appendChild(left)
      div.appendChild(right)
      listEl.appendChild(div)
    })
  }

  render()
})
</script>
</body>
</html>
